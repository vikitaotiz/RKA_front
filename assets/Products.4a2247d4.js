import{bO as De,c4 as Se,r as u,j as Ue,aJ as p,a6 as A,d as a,bb as o,u as f,Q as d,a4 as $,a7 as s,bE as b,a5 as T,ad as i,bD as L,N as Ae,bd as F,bw as ie}from"./index.23dc9da6.js";import{Q as de}from"./QToggle.c36b21de.js";import{a as W,Q as H}from"./QCard.9a800df7.js";import{Q as $e,a as ce,b as v,c as Te,d as me,e as Me,f as Ee,g as Ne}from"./excel.98ef1913.js";import{Q as X}from"./QBadge.e440cddb.js";import{Q as h}from"./QInput.65e734ea.js";import{Q as Z}from"./QSpace.13f3118c.js";import{Q as Be}from"./QToolbar.a6f3bc59.js";import{Q as ee}from"./QSeparator.b4d19301.js";import{Q as Ye}from"./QBtnGroup.b7041d10.js";import{s as ze,t as Ie}from"./rtl.b36304b3.js";import{a as Oe}from"./use-quasar.3a5c0f88.js";import{a as Le,u as le,b as Fe}from"./index.94426fc4.js";import{h as M}from"./moment.9709ab41.js";import{u as Ke}from"./product-store.00c731a9.js";import{u as Re}from"./category-store.034dad0c.js";import{u as Ge}from"./measurement-store.33d500b8.js";import{u as je}from"./auth-store.42f05153.js";import{h as Je}from"./helpers.a81d5275.js";import"./use-dark.75514965.js";import"./QList.1a552281.js";import"./module_calls.108866f1.js";function pe(r){if(r===!1)return 0;if(r===!0||r===void 0)return 1;const m=parseInt(r,10);return isNaN(m)?0:m}var ve=De({name:"close-popup",beforeMount(r,{value:m}){const c={depth:pe(m),handler(_){c.depth!==0&&setTimeout(()=>{const y=ze(r);y!==void 0&&Ie(y,_,c.depth)})},handlerKey(_){Se(_,13)===!0&&c.handler(_)}};r.__qclosepopup=c,r.addEventListener("click",c.handler),r.addEventListener("keyup",c.handlerKey)},updated(r,{value:m,oldValue:c}){m!==c&&(r.__qclosepopup.depth=pe(m))},beforeUnmount(r){const m=r.__qclosepopup;r.removeEventListener("click",m.handler),r.removeEventListener("keyup",m.handlerKey),delete r.__qclosepopup}});const fe=[{name:"name",required:!0,label:"Name",align:"left",field:r=>r.name,format:r=>`${r}`,sortable:!0},{name:"measurement",align:"center",label:"Measurement & Qty",field:"measurement",sortable:!0},{name:"buying_price",align:"center",label:"Buying Price (Per Unit)",field:"buying_price",sortable:!0},{name:"amount_to_be_paid",align:"center",label:"Amount to be Paid",field:"amount_to_be_paid",sortable:!0},{name:"selling_price",align:"center",label:"Selling Price (Per Unit)",field:"selling_price",sortable:!0},{name:"supplier",align:"center",label:"Supplier",field:"supplier",sortable:!0},{name:"paid",align:"center",label:"Paid",field:"paid",sortable:!0},{name:"amount_paid",align:"center",label:"Actual Amount Paid",field:"amount_paid",sortable:!0},{name:"category",align:"center",label:"Category",field:"category",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}];const We={class:"q-pa-md"},He={class:"col-lg-4 col-md-4 col-sm-12 col-xs-12"},Xe={class:"col-lg-4 col-md-4 col-sm-12 col-xs-12"},Ze={class:"col-lg-2 col-md-2 col-sm-12 col-xs-12"},el={class:"col-lg-2 col-md-2 col-sm-12 col-xs-12"},ll={key:0},tl={key:1},al={key:0},ol={key:1},ul={class:"text-h6"},rl={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},sl={style:{"background-color":"#017951",color:"white",padding:"5px"}},nl={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},il={class:"text-center error_msg"},dl={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},cl={class:"q-mb-sm q-pa-md"},ml={class:"text-center q-ma-sm"},pl=["max"],vl=s("br",null,null,-1),fl={key:0},_l=["max"],Yl={__name:"Products",setup(r){const m=je(),c=Oe(),_=Le(),y=Ke(),te=Re(),_e=Ge(),E=u(!1),N=u(!1),C=u(!1),I=u(!1),K=u(""),O=u(""),ae=u(""),w=u(""),k=u(""),V=u(1),P=u(1),D=u(1),B=u(""),Y=u(""),q=u(!1),x=u(0),R=u(!1),oe=new Date().toISOString().split("T")[0],ue=u("Today"),ge=()=>R.value=!0,n=Ue({from:"",to:""}),z=u([]),{isLoading:be,isError:re}=le("products",()=>y.fetchProducts(),{onSuccess:t=>{z.value=t}}),S=u("");let G=u([]);const U=u("");let j=u([]);le("categories",()=>te.fetchCategories(),{onSuccess:t=>{j.value=t.map(l=>({uuid:l.uuid,name:l.name}))}}),le("measurements",()=>_e.fetchMeasurements(),{onSuccess:t=>{G.value=t.map(l=>({uuid:l.uuid,name:l.name}))}});const ye=async t=>{if(confirm(`Continue with the operation. Delete ${t.name} ?`)){const e=await y.deleteProduct({uuid:t.uuid});e.status==="success"?(_.refetchQueries("products"),g(e.message,"green","top")):g("There was an error","red","top-right")}},ke=()=>{N.value=!1,te.categories.length===0?g("You need to create at least one CATEGORY in order to create products!","orange","top"):(O.value="Add New Product",E.value=!0)},he=t=>{N.value=!0,O.value=`Edit ${t.name}`,ae.value=t.uuid,E.value=!0,k.value=t.name,V.value=t.quantity,P.value=t.buying_price,D.value=t.selling_price,x.value=t.amount_paid,B.value=t.supplier,q.value=!!t.paid,Y.value=t.description,S.value=G.value.find(l=>l.name===t.measurement),U.value=j.value.find(l=>l.name===t.category)},we=async()=>{w.value="",C.value=!0;const t={name:k.value.trim(),quantity:V.value,selling_price:D.value,buying_price:P.value,amount_paid:x.value,category_uuid:U.value.uuid,measurement_uuid:S.value.uuid,supplier:B.value,paid:!!q.value,description:Y.value};if(t.name&&t.quantity&&t.selling_price&&t.buying_price&&t.category_uuid&&t.measurement_uuid&&t.supplier){const l=await y.createProduct(t);l.status==="success"?(_.refetchQueries("products"),J(),g(l.message,"green","top")):(w.value=l.message,g(l.message,"red","top-right"))}else w.value="All fields are required!",C.value=!1,g("All fields are required!","red","top-right")},Ve=async()=>{w.value="",C.value=!0;const t={product_uuid:ae.value,name:k.value.trim(),quantity:V.value,selling_price:D.value,buying_price:P.value,amount_paid:x.value==1?x.value:0,category_uuid:U.value.uuid,measurement_uuid:S.value.uuid,supplier:B.value,paid:q.value,description:Y.value};if(t.name&&t.quantity&&t.selling_price&&t.buying_price&&t.category_uuid&&t.measurement_uuid&&t.supplier){const l=await y.updateProduct(t);l.status==="success"?(_.refetchQueries("products"),_.refetchQueries("finished_products"),J(),g(l.message,"green","top")):g(l.message,"red","top-right")}else w.value="All fields are required!",g("All fields are required!","red","top-right")},Pe=()=>J(),g=(t,l,e)=>{c.notify({message:t,color:l,position:e})},J=()=>{k.value="",D.value=1,P.value=1,x.value=1,U.value="",S.value="",V.value=1,E.value=!1,C.value=!1,N.value=!1,O.value="",w.value="",q.value=!1},qe=t=>{const l=t.map(e=>({name:e.name,buying_price:e.buying_price,selling_price:e.selling_price,category:e.category,measurement:e.measurement,paid:e.paid,amount_paid:e.amount_paid,quantity:e.quantity,supplier:e.supplier,description:e.description,user:e.user,created_at:e.created_at}));Ee(l,fe,Ne,c,"ProductsData")},xe=()=>{let t=M(n.from),l=M(n.to),e={};parseInt(t.diff(l,"seconds"))>=0?(e.from=n.from,e.to=n.to):(e.from=n.to,e.to=n.from),Qe(e),c.loading.show({message:`Please Wait. Fetching data between ${M(n.from).format("DD-MM-YY")} - ${M(n.to).format("DD-MM-YY")}`,boxClass:"bg-indigo text-white",spinnerColor:"white"})},{mutate:Qe}=Fe(t=>y.fetchProductsInDateRange(t),{onSuccess:t=>{var l;ue.value=`(From: ${M(n.from).format("DD-MM-YY")} - To: ${M(n.to).format("DD-MM-YY")}). ${(l=t==null?void 0:t.data)==null?void 0:l.length} Records.`,z.value=t.data,c.loading.hide()}});return(t,l)=>(p(),A("div",We,[a(W,{dark:"",class:"row q-col-gutter-sm bg-primary q-mb-sm q-pa-none"},{default:o(()=>{var e;return[s("div",He,[a(b,{size:"sm",outline:"",icon:"arrow_back",label:"Back",onClick:l[0]||(l[0]=Q=>t.$router.back())}),a(de,{size:"sm",modelValue:I.value,"onUpdate:modelValue":l[1]||(l[1]=Q=>I.value=Q),"checked-icon":"check",color:"orange","unchecked-icon":"clear",label:`${I.value?"Table View.":"Mobile View."}`},null,8,["modelValue","label"])]),s("div",Xe,[a(b,{size:"sm",unelevated:"",icon:"event",color:"indigo",label:"Calendar (Older Products)",onClick:l[2]||(l[2]=Q=>ge())})]),s("div",Ze,[a(b,{onClick:ke,size:"sm",color:"orange",icon:"add",label:"Add Product",unelevated:"",class:"full-width"})]),s("div",el,[((e=z.value)==null?void 0:e.length)>0?(p(),$(b,{key:0,size:"sm",outline:"",icon:"archive",label:"Export",onClick:l[3]||(l[3]=Q=>qe(z.value))})):T("",!0)])]}),_:1}),f(be)?(p(),A("div",ll,"Loading products...")):f(re)?(p(),A("div",tl,"An error has occurred: "+d(f(re)),1)):(p(),$($e,{key:2,title:`Products : ${ue.value}`,rows:z.value,columns:f(fe),separator:"cell","row-key":"name",filter:K.value,dense:"",grid:I.value},{body:o(e=>[a(Te,{props:e,class:Ae(`${e.row.quantity<1?"blink-bg":""}`)},{default:o(()=>{var Q,se,ne;return[a(v,{key:"name",props:e},{default:o(()=>[i(d(e.row.name),1)]),_:2},1032,["props"]),a(v,{key:"measurement",props:e},{default:o(()=>[i(d(e.row.measurement)+" ",1),s("small",null,[a(X,null,{default:o(()=>[i(": "+d(e.row.quantity),1)]),_:2},1024)])]),_:2},1032,["props"]),a(v,{key:"buying_price",props:e},{default:o(()=>[i(d(e.row.buying_price),1)]),_:2},1032,["props"]),a(v,{key:"amount_to_be_paid",props:e},{default:o(()=>[i(d(e.row.amount_to_be_paid),1)]),_:2},1032,["props"]),a(v,{key:"selling_price",props:e},{default:o(()=>[i(d(e.row.selling_price),1)]),_:2},1032,["props"]),a(v,{key:"supplier",props:e},{default:o(()=>[i(d(e.row.supplier),1)]),_:2},1032,["props"]),a(v,{key:"paid",props:e},{default:o(()=>[e.row.paid?(p(),A("span",al,[a(X,{color:"primary"},{default:o(()=>[i("Paid")]),_:1})])):(p(),A("span",ol,[a(X,{color:"negative"},{default:o(()=>[i("Not Paid")]),_:1})]))]),_:2},1032,["props"]),a(v,{key:"amount_paid",props:e},{default:o(()=>[i(d(e.row.amount_paid),1)]),_:2},1032,["props"]),a(v,{key:"category",props:e},{default:o(()=>[i(d(e.row.category),1)]),_:2},1032,["props"]),a(v,{key:"user",props:e},{default:o(()=>[i(d(e.row.user),1)]),_:2},1032,["props"]),a(v,{key:"created_at",props:e},{default:o(()=>[i(d(e.row.created_at),1)]),_:2},1032,["props"]),f(Je)((ne=(se=(Q=f(m))==null?void 0:Q.user)==null?void 0:se.user)==null?void 0:ne.roles)?(p(),$(v,{key:"actions",props:e},{default:o(()=>[a(L,{color:"blue",name:"edit",onClick:Ce=>he(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),a(L,{color:"red",name:"delete",onClick:Ce=>ye(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])):T("",!0)]}),_:2},1032,["props","class"])]),"top-right":o(()=>[a(h,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:K.value,"onUpdate:modelValue":l[4]||(l[4]=e=>K.value=e),placeholder:"Search product",class:"q-mr-md",clearable:""},{append:o(()=>[a(L,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["title","rows","columns","filter","grid"])),a(ce,{modelValue:E.value,"onUpdate:modelValue":l[15]||(l[15]=e=>E.value=e),persistent:""},{default:o(()=>[a(W,{style:{width:"500px"}},{default:o(()=>[a(Be,null,{default:o(()=>[s("span",ul,d(O.value),1),a(Z),s("span",null,[a(de,{modelValue:q.value,"onUpdate:modelValue":l[5]||(l[5]=e=>q.value=e),"checked-icon":"check",color:"green","unchecked-icon":"clear",label:`${q.value?"Paid":"Not Paid."}`,class:"col-6"},null,8,["modelValue","label"])])]),_:1}),a(ee,{color:"primary",class:"q-mb-sm"}),a(H,{class:"q-pt-none"},{default:o(()=>[a(h,{outlined:"",dense:"",label:"Name",modelValue:k.value,"onUpdate:modelValue":l[6]||(l[6]=e=>k.value=e)},null,8,["modelValue"])]),_:1}),a(H,{class:"q-pt-none"},{default:o(()=>[a(h,{outlined:"",dense:"",label:"Quantity",modelValue:V.value,"onUpdate:modelValue":l[7]||(l[7]=e=>V.value=e),type:"number",min:"1",oninput:"validity.valid||(value='')"},null,8,["modelValue"])]),_:1}),s("div",rl,[a(h,{outlined:"",dense:"",label:"Buying Price (Per Unit)",modelValue:P.value,"onUpdate:modelValue":l[8]||(l[8]=e=>P.value=e),type:"number",min:"1",oninput:"validity.valid||(value='');",class:"col-6"},null,8,["modelValue"]),a(h,{outlined:"",dense:"",label:"Selling Price (Per Unit)",modelValue:D.value,"onUpdate:modelValue":l[9]||(l[9]=e=>D.value=e),type:"number",min:"1",oninput:"validity.valid||(value='');",class:"col-6"},null,8,["modelValue"])]),s("div",sl," Amount to be paid : "+d(P.value*V.value),1),s("div",nl,[a(me,{dense:"",outlined:"",modelValue:U.value,"onUpdate:modelValue":l[10]||(l[10]=e=>U.value=e),options:f(j),"option-value":"uuid","option-label":"name",label:"Select Product Category",class:"col-6"},null,8,["modelValue","options"]),a(me,{dense:"",outlined:"",modelValue:S.value,"onUpdate:modelValue":l[11]||(l[11]=e=>S.value=e),options:f(G),"option-value":"uuid","option-label":"name",label:"Select Product Measurement",class:"col-6"},null,8,["modelValue","options"])]),s("div",il,[s("small",null,d(w.value),1)]),s("div",dl,[a(h,{outlined:"",dense:"",label:"Supplier",modelValue:B.value,"onUpdate:modelValue":l[12]||(l[12]=e=>B.value=e),type:"text",class:"col-6"},null,8,["modelValue"]),a(h,{outlined:"",dense:"",label:"Actual Amount paid to supplier (Optional)",modelValue:x.value,"onUpdate:modelValue":l[13]||(l[13]=e=>x.value=e),type:"number",min:"1",oninput:"validity.valid||(value='');",class:"col-6"},null,8,["modelValue"])]),s("div",cl,[a(h,{modelValue:Y.value,"onUpdate:modelValue":l[14]||(l[14]=e=>Y.value=e),label:"Description (Optional)",outlined:"",autogrow:""},null,8,["modelValue"])]),a(Me,{align:"right"},{default:o(()=>[a(b,{flat:"",label:"Cancel",color:"red",onClick:Pe}),a(Z),k.value&&!N.value?(p(),$(b,{key:0,flat:"",label:"Add Product",color:"primary",onClick:we,loading:C.value},null,8,["loading"])):T("",!0),k.value&&N.value?(p(),$(b,{key:1,flat:"",label:"Edit Product",color:"primary",onClick:Ve,loading:C.value},null,8,["loading"])):T("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ce,{modelValue:R.value,"onUpdate:modelValue":l[18]||(l[18]=e=>R.value=e),persistent:""},{default:o(()=>[a(W,{class:"bg-indigo text-white text-center q-pa-sm",style:{width:"300px"}},{default:o(()=>[s("div",ml,[s("b",null,[a(L,{name:"events"}),i(" Date Picker")])]),a(ee,{color:"white"}),a(H,null,{default:o(()=>[s("div",null,[i(" From : "),F(s("input",{type:"date","onUpdate:modelValue":l[16]||(l[16]=e=>n.from=e),max:f(oe)},null,8,pl),[[ie,n.from]])]),vl,n.from?(p(),A("div",fl,[i(" To : "),F(s("input",{type:"date","onUpdate:modelValue":l[17]||(l[17]=e=>n.to=e),max:f(oe)},null,8,_l),[[ie,n.to]])])):T("",!0)]),_:1}),a(ee,{color:"yellow"}),a(Ye,{flat:"",class:"full-width"},{default:o(()=>[F(a(b,{dense:"",label:"Cancel",color:"yellow",flat:""},null,512),[[ve]]),a(Z),n.to?F((p(),$(b,{key:0,dense:"",label:"Fetch Products",color:"white",flat:"",onClick:xe},null,512)),[[ve]]):T("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Yl as default};
