import{bO as Ce,c4 as De,r,j as Se,aJ as m,a6 as U,d as a,bb as o,u as v,Q as p,a4 as $,a7 as u,bE as y,a5 as T,ad as i,bD as L,N as Ue,bd as O,bw as ne}from"./index.177bb256.js";import{Q as ie}from"./QToggle.05672915.js";import{a as J,Q as W}from"./QCard.b17cf723.js";import{Q as $e,a as de,b as f,c as Te,d as ce,e as Me,f as Ee,g as Ae}from"./excel.b5e535cd.js";import{Q as H}from"./QBadge.e8662a7b.js";import{Q as P}from"./QInput.4c9d6d95.js";import{Q as X}from"./QSpace.79904010.js";import{Q as Ne}from"./QToolbar.93bf7df2.js";import{Q as Z}from"./QSeparator.58e3957a.js";import{Q as Be}from"./QBtnGroup.3aae0157.js";import{s as Ye,t as ze}from"./rtl.f5ce977d.js";import{a as Ie}from"./use-quasar.569f70bf.js";import{a as Le,u as ee,b as Oe}from"./index.e3f0c335.js";import{h as M}from"./moment.9709ab41.js";import{u as Fe}from"./product-store.84b68601.js";import{u as Ke}from"./category-store.0ead0822.js";import{u as Re}from"./measurement-store.b2478ad7.js";import{u as Ge}from"./auth-store.d66f65a6.js";import{h as je}from"./helpers.a81d5275.js";import"./use-dark.6d59c91e.js";import"./QList.78288267.js";import"./module_calls.108866f1.js";function me(s){if(s===!1)return 0;if(s===!0||s===void 0)return 1;const c=parseInt(s,10);return isNaN(c)?0:c}var pe=Ce({name:"close-popup",beforeMount(s,{value:c}){const d={depth:me(c),handler(g){d.depth!==0&&setTimeout(()=>{const b=Ye(s);b!==void 0&&ze(b,g,d.depth)})},handlerKey(g){De(g,13)===!0&&d.handler(g)}};s.__qclosepopup=d,s.addEventListener("click",d.handler),s.addEventListener("keyup",d.handlerKey)},updated(s,{value:c,oldValue:d}){c!==d&&(s.__qclosepopup.depth=me(c))},beforeUnmount(s){const c=s.__qclosepopup;s.removeEventListener("click",c.handler),s.removeEventListener("keyup",c.handlerKey),delete s.__qclosepopup}});const ve=[{name:"name",required:!0,label:"Name",align:"left",field:s=>s.name,format:s=>`${s}`,sortable:!0},{name:"measurement",align:"center",label:"Measurement & Qty",field:"measurement",sortable:!0},{name:"buying_price",align:"center",label:"Buying Price (Per Unit)",field:"buying_price",sortable:!0},{name:"selling_price",align:"center",label:"Selling Price (Per Unit)",field:"selling_price",sortable:!0},{name:"supplier",align:"center",label:"Supplier",field:"supplier",sortable:!0},{name:"paid",align:"center",label:"Paid",field:"paid",sortable:!0},{name:"category",align:"center",label:"Category",field:"category",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}];const Je={class:"q-pa-md"},We={class:"col-lg-4 col-md-4 col-sm-12 col-xs-12"},He={class:"col-lg-4 col-md-4 col-sm-12 col-xs-12"},Xe={class:"col-lg-2 col-md-2 col-sm-12 col-xs-12"},Ze={class:"col-lg-2 col-md-2 col-sm-12 col-xs-12"},el={key:0},ll={key:1},tl={key:0},al={key:1},ol={class:"text-h6"},rl={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},sl={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},ul={class:"text-center error_msg"},nl={class:"q-mb-sm q-pa-md"},il={class:"q-mb-sm q-pa-md"},dl={class:"text-center q-ma-sm"},cl=["max"],ml=u("br",null,null,-1),pl={key:0},vl=["max"],Nl={__name:"Products",setup(s){const c=Ge(),d=Ie(),g=Le(),b=Fe(),le=Ke(),fe=Re(),E=r(!1),A=r(!1),q=r(!1),z=r(!1),F=r(""),I=r(""),te=r(""),h=r(""),k=r(""),Q=r(1),x=r(1),C=r(1),N=r(""),B=r(""),w=r(!1),K=r(!1),ae=new Date().toISOString().split("T")[0],oe=r("Today"),ge=()=>K.value=!0,n=Se({from:"",to:""}),Y=r([]),{isLoading:_e,isError:re}=ee("products",()=>b.fetchProducts(),{onSuccess:t=>{Y.value=t}}),D=r("");let R=r([]);const S=r("");let G=r([]);ee("categories",()=>le.fetchCategories(),{onSuccess:t=>{G.value=t.map(l=>({uuid:l.uuid,name:l.name}))}}),ee("measurements",()=>fe.fetchMeasurements(),{onSuccess:t=>{R.value=t.map(l=>({uuid:l.uuid,name:l.name}))}});const ye=async t=>{if(confirm(`Continue with the operation. Delete ${t.name} ?`)){const e=await b.deleteProduct({uuid:t.uuid});e.status==="success"?(g.refetchQueries("products"),_(e.message,"green","top")):_("There was an error","red","top-right")}},be=()=>{A.value=!1,le.categories.length===0?_("You need to create at least one CATEGORY in order to create products!","orange","top"):(I.value="Add New Product",E.value=!0)},ke=t=>{A.value=!0,I.value=`Edit ${t.name}`,te.value=t.uuid,E.value=!0,k.value=t.name,Q.value=t.quantity,x.value=t.buying_price,C.value=t.selling_price,N.value=t.supplier,w.value=!!t.paid,B.value=t.description,D.value=R.value.find(l=>l.name===t.measurement),S.value=G.value.find(l=>l.name===t.category)},he=async()=>{h.value="",q.value=!0;const t={name:k.value.trim(),quantity:Q.value,selling_price:C.value,buying_price:x.value,category_uuid:S.value.uuid,measurement_uuid:D.value.uuid,supplier:N.value,paid:!!w.value,description:B.value};if(t.name&&t.quantity&&t.selling_price&&t.buying_price&&t.category_uuid&&t.measurement_uuid&&t.supplier){const l=await b.createProduct(t);l.status==="success"?(g.refetchQueries("products"),j(),_(l.message,"green","top")):(h.value=l.message,_(l.message,"red","top-right"))}else h.value="All fields are required!",q.value=!1,_("All fields are required!","red","top-right")},we=async()=>{h.value="",q.value=!0;const t={product_uuid:te.value,name:k.value.trim(),quantity:Q.value,selling_price:C.value,buying_price:x.value,category_uuid:S.value.uuid,measurement_uuid:D.value.uuid,supplier:N.value,paid:w.value,description:B.value};if(t.name&&t.quantity&&t.selling_price&&t.buying_price&&t.category_uuid&&t.measurement_uuid&&t.supplier){const l=await b.updateProduct(t);l.status==="success"?(g.refetchQueries("products"),g.refetchQueries("finished_products"),j(),_(l.message,"green","top")):_(l.message,"red","top-right")}else h.value="All fields are required!",_("All fields are required!","red","top-right")},Ve=()=>j(),_=(t,l,e)=>{d.notify({message:t,color:l,position:e})},j=()=>{k.value="",C.value=1,x.value=1,S.value="",D.value="",Q.value=1,E.value=!1,q.value=!1,A.value=!1,I.value="",h.value="",w.value=!1},Pe=t=>{const l=t.map(e=>({name:e.name,buying_price:e.buying_price,selling_price:e.selling_price,category:e.category,measurement:e.measurement,paid:e.paid,quantity:e.quantity,supplier:e.supplier,description:e.description,user:e.user,created_at:e.created_at}));Ee(l,ve,Ae,d,"ProductsData")},qe=()=>{let t=M(n.from),l=M(n.to),e={};parseInt(t.diff(l,"seconds"))>=0?(e.from=n.from,e.to=n.to):(e.from=n.to,e.to=n.from),Qe(e),d.loading.show({message:`Please Wait. Fetching data between ${M(n.from).format("DD-MM-YY")} - ${M(n.to).format("DD-MM-YY")}`,boxClass:"bg-indigo text-white",spinnerColor:"white"})},{mutate:Qe}=Oe(t=>b.fetchProductsInDateRange(t),{onSuccess:t=>{var l;oe.value=`(From: ${M(n.from).format("DD-MM-YY")} - To: ${M(n.to).format("DD-MM-YY")}). ${(l=t==null?void 0:t.data)==null?void 0:l.length} Records.`,Y.value=t.data,d.loading.hide()}});return(t,l)=>(m(),U("div",Je,[a(J,{dark:"",class:"row q-col-gutter-sm bg-primary q-mb-sm q-pa-none"},{default:o(()=>{var e;return[u("div",We,[a(y,{size:"sm",outline:"",icon:"arrow_back",label:"Back",onClick:l[0]||(l[0]=V=>t.$router.back())}),a(ie,{size:"sm",modelValue:z.value,"onUpdate:modelValue":l[1]||(l[1]=V=>z.value=V),"checked-icon":"check",color:"orange","unchecked-icon":"clear",label:`${z.value?"Table View.":"Mobile View."}`},null,8,["modelValue","label"])]),u("div",He,[a(y,{size:"sm",unelevated:"",icon:"event",color:"indigo",label:"Calendar (Older Products)",onClick:l[2]||(l[2]=V=>ge())})]),u("div",Xe,[a(y,{onClick:be,size:"sm",color:"orange",icon:"add",label:"Add Product",unelevated:"",class:"full-width"})]),u("div",Ze,[((e=Y.value)==null?void 0:e.length)>0?(m(),$(y,{key:0,size:"sm",outline:"",icon:"archive",label:"Export",onClick:l[3]||(l[3]=V=>Pe(Y.value))})):T("",!0)])]}),_:1}),v(_e)?(m(),U("div",el,"Loading products...")):v(re)?(m(),U("div",ll,"An error has occurred: "+p(v(re)),1)):(m(),$($e,{key:2,title:`Products : ${oe.value}`,rows:Y.value,columns:v(ve),separator:"cell","row-key":"name",filter:F.value,dense:"",grid:z.value},{body:o(e=>[a(Te,{props:e,class:Ue(`${e.row.quantity<1?"blink-bg":""}`)},{default:o(()=>{var V,se,ue;return[a(f,{key:"name",props:e},{default:o(()=>[i(p(e.row.name),1)]),_:2},1032,["props"]),a(f,{key:"measurement",props:e},{default:o(()=>[i(p(e.row.measurement)+" ",1),u("small",null,[a(H,null,{default:o(()=>[i(": "+p(e.row.quantity),1)]),_:2},1024)])]),_:2},1032,["props"]),a(f,{key:"buying_price",props:e},{default:o(()=>[i(p(e.row.buying_price),1)]),_:2},1032,["props"]),a(f,{key:"selling_price",props:e},{default:o(()=>[i(p(e.row.selling_price),1)]),_:2},1032,["props"]),a(f,{key:"supplier",props:e},{default:o(()=>[i(p(e.row.supplier),1)]),_:2},1032,["props"]),a(f,{key:"paid",props:e},{default:o(()=>[e.row.paid?(m(),U("span",tl,[a(H,{color:"primary"},{default:o(()=>[i("Paid")]),_:1})])):(m(),U("span",al,[a(H,{color:"negative"},{default:o(()=>[i("Not Paid")]),_:1})]))]),_:2},1032,["props"]),a(f,{key:"category",props:e},{default:o(()=>[i(p(e.row.category),1)]),_:2},1032,["props"]),a(f,{key:"user",props:e},{default:o(()=>[i(p(e.row.user),1)]),_:2},1032,["props"]),a(f,{key:"created_at",props:e},{default:o(()=>[i(p(e.row.created_at),1)]),_:2},1032,["props"]),v(je)((ue=(se=(V=v(c))==null?void 0:V.user)==null?void 0:se.user)==null?void 0:ue.roles)?(m(),$(f,{key:"actions",props:e},{default:o(()=>[a(L,{color:"blue",name:"edit",onClick:xe=>ke(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),a(L,{color:"red",name:"delete",onClick:xe=>ye(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])):T("",!0)]}),_:2},1032,["props","class"])]),"top-right":o(()=>[a(P,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:F.value,"onUpdate:modelValue":l[4]||(l[4]=e=>F.value=e),placeholder:"Search product",class:"q-mr-md",clearable:""},{append:o(()=>[a(L,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["title","rows","columns","filter","grid"])),a(de,{modelValue:E.value,"onUpdate:modelValue":l[14]||(l[14]=e=>E.value=e),persistent:""},{default:o(()=>[a(J,{style:{width:"500px"}},{default:o(()=>[a(Ne,null,{default:o(()=>[u("span",ol,p(I.value),1),a(X),u("span",null,[a(ie,{modelValue:w.value,"onUpdate:modelValue":l[5]||(l[5]=e=>w.value=e),"checked-icon":"check",color:"green","unchecked-icon":"clear",label:`${w.value?"Paid":"Not Paid."}`,class:"col-6"},null,8,["modelValue","label"])])]),_:1}),a(Z,{color:"primary",class:"q-mb-sm"}),a(W,{class:"q-pt-none"},{default:o(()=>[a(P,{outlined:"",dense:"",label:"Name",modelValue:k.value,"onUpdate:modelValue":l[6]||(l[6]=e=>k.value=e)},null,8,["modelValue"])]),_:1}),a(W,{class:"q-pt-none"},{default:o(()=>[a(P,{outlined:"",dense:"",label:"Quantity",modelValue:Q.value,"onUpdate:modelValue":l[7]||(l[7]=e=>Q.value=e),type:"number",min:"1",oninput:"validity.valid||(value='')"},null,8,["modelValue"])]),_:1}),u("div",rl,[a(P,{outlined:"",dense:"",label:"Buying Price (Per Unit)",modelValue:x.value,"onUpdate:modelValue":l[8]||(l[8]=e=>x.value=e),type:"number",min:"1",oninput:"validity.valid||(value='');",class:"col-6"},null,8,["modelValue"]),a(P,{outlined:"",dense:"",label:"Selling Price (Per Unit)",modelValue:C.value,"onUpdate:modelValue":l[9]||(l[9]=e=>C.value=e),type:"number",min:"1",oninput:"validity.valid||(value='');",class:"col-6"},null,8,["modelValue"])]),u("div",sl,[a(ce,{dense:"",outlined:"",modelValue:S.value,"onUpdate:modelValue":l[10]||(l[10]=e=>S.value=e),options:v(G),"option-value":"uuid","option-label":"name",label:"Select Product Category",class:"col-6"},null,8,["modelValue","options"]),a(ce,{dense:"",outlined:"",modelValue:D.value,"onUpdate:modelValue":l[11]||(l[11]=e=>D.value=e),options:v(R),"option-value":"uuid","option-label":"name",label:"Select Product Measurement",class:"col-6"},null,8,["modelValue","options"])]),u("div",ul,[u("small",null,p(h.value),1)]),u("div",nl,[a(P,{outlined:"",dense:"",label:"Supplier",modelValue:N.value,"onUpdate:modelValue":l[12]||(l[12]=e=>N.value=e),type:"text"},null,8,["modelValue"])]),u("div",il,[a(P,{modelValue:B.value,"onUpdate:modelValue":l[13]||(l[13]=e=>B.value=e),label:"Description (Optional)",outlined:"",autogrow:""},null,8,["modelValue"])]),a(Me,{align:"right"},{default:o(()=>[a(y,{flat:"",label:"Cancel",color:"red",onClick:Ve}),a(X),k.value&&!A.value?(m(),$(y,{key:0,flat:"",label:"Add Product",color:"primary",onClick:he,loading:q.value},null,8,["loading"])):T("",!0),k.value&&A.value?(m(),$(y,{key:1,flat:"",label:"Edit Product",color:"primary",onClick:we,loading:q.value},null,8,["loading"])):T("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(de,{modelValue:K.value,"onUpdate:modelValue":l[17]||(l[17]=e=>K.value=e),persistent:""},{default:o(()=>[a(J,{class:"bg-indigo text-white text-center q-pa-sm",style:{width:"300px"}},{default:o(()=>[u("div",dl,[u("b",null,[a(L,{name:"events"}),i(" Date Picker")])]),a(Z,{color:"white"}),a(W,null,{default:o(()=>[u("div",null,[i(" From : "),O(u("input",{type:"date","onUpdate:modelValue":l[15]||(l[15]=e=>n.from=e),max:v(ae)},null,8,cl),[[ne,n.from]])]),ml,n.from?(m(),U("div",pl,[i(" To : "),O(u("input",{type:"date","onUpdate:modelValue":l[16]||(l[16]=e=>n.to=e),max:v(ae)},null,8,vl),[[ne,n.to]])])):T("",!0)]),_:1}),a(Z,{color:"yellow"}),a(Be,{flat:"",class:"full-width"},{default:o(()=>[O(a(y,{dense:"",label:"Cancel",color:"yellow",flat:""},null,512),[[pe]]),a(X),n.to?O((m(),$(y,{key:0,dense:"",label:"Fetch Products",color:"white",flat:"",onClick:qe},null,512)),[[pe]]):T("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Nl as default};
