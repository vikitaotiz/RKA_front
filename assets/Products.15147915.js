import{bO as Se,c4 as Ue,r,j as $e,aJ as m,a6 as V,d as a,bb as o,u as p,Q as v,a4 as T,bE as y,a7 as n,a5 as w,ad as i,bD as R,N as Te,bd as G,bw as ie}from"./index.66bc2642.js";import{Q as F}from"./QSpace.0655bead.js";import{Q as de}from"./QToggle.6c366773.js";import{Q as ce}from"./QToolbar.af36c966.js";import{a as Z,Q as ee}from"./QCard.583f3661.js";import{Q as Me,a as me,b as f,c as Ee,d as pe,e as Ae,f as Ne,g as Be}from"./excel.3e68f58c.js";import{Q as le}from"./QBadge.84cdd5a3.js";import{Q as q}from"./QInput.6efcdc1c.js";import{Q as te}from"./QSeparator.fd4fd6c3.js";import{Q as Ye}from"./QBtnGroup.c70eb5ab.js";import{s as Ie,t as ze}from"./rtl.bb616fdf.js";import{a as Le}from"./use-quasar.cabfd63d.js";import{a as Oe,u as ae,b as Fe}from"./index.2f23f711.js";import{h as M}from"./moment.9709ab41.js";import{u as Ke}from"./product-store.482689e8.js";import{u as Re}from"./category-store.163ecd7c.js";import{u as Ge}from"./measurement-store.e36addd5.js";import{u as je}from"./auth-store.6b2db181.js";import{h as ve}from"./helpers.a81d5275.js";import"./use-dark.de417b2a.js";import"./QList.98c4781a.js";import"./module_calls.108866f1.js";function fe(u){if(u===!1)return 0;if(u===!0||u===void 0)return 1;const d=parseInt(u,10);return isNaN(d)?0:d}var ge=Se({name:"close-popup",beforeMount(u,{value:d}){const c={depth:fe(d),handler(g){c.depth!==0&&setTimeout(()=>{const b=Ie(u);b!==void 0&&ze(b,g,c.depth)})},handlerKey(g){Ue(g,13)===!0&&c.handler(g)}};u.__qclosepopup=c,u.addEventListener("click",c.handler),u.addEventListener("keyup",c.handlerKey)},updated(u,{value:d,oldValue:c}){d!==c&&(u.__qclosepopup.depth=fe(d))},beforeUnmount(u){const d=u.__qclosepopup;u.removeEventListener("click",d.handler),u.removeEventListener("keyup",d.handlerKey),delete u.__qclosepopup}});const _e=[{name:"name",required:!0,label:"Name",align:"left",field:u=>u.name,format:u=>`${u}`,sortable:!0},{name:"measurement",align:"center",label:"Measurement & Qty",field:"measurement",sortable:!0},{name:"buying_price",align:"center",label:"Buying Price (Per Unit)",field:"buying_price",sortable:!0},{name:"selling_price",align:"center",label:"Selling Price (Per Unit)",field:"selling_price",sortable:!0},{name:"supplier",align:"center",label:"Supplier",field:"supplier",sortable:!0},{name:"paid",align:"center",label:"Paid",field:"paid",sortable:!0},{name:"category",align:"center",label:"Category",field:"category",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}];const Je={class:"q-pa-md"},We={key:0,class:"q-ml-sm"},He={key:0},Xe={key:1},Ze={key:0},el={key:1},ll={class:"text-h6"},tl={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},al={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},ol={class:"text-center error_msg"},rl={class:"q-mb-sm q-pa-md"},ul={class:"q-mb-sm q-pa-md"},sl={class:"text-center q-ma-sm"},nl=["max"],il=n("br",null,null,-1),dl={key:0},cl=["max"],Ml={__name:"Products",setup(u){const d=je(),c=Le(),g=Oe(),b=Ke(),oe=Re(),ye=Ge(),E=r(!1),A=r(!1),Q=r(!1),N=r(!1),j=r(""),K=r(""),re=r(""),h=r(""),k=r(""),C=r(1),x=r(1),D=r(1),B=r(""),Y=r(""),P=r(!1),J=r(!1),ue=new Date().toISOString().split("T")[0],se=r("Today"),be=()=>J.value=!0,s=$e({from:"",to:""}),I=r([]),{isLoading:ke,isError:ne}=ae("products",()=>b.fetchProducts(),{onSuccess:t=>{I.value=t}}),S=r("");let W=r([]);const U=r("");let H=r([]);ae("categories",()=>oe.fetchCategories(),{onSuccess:t=>{H.value=t.map(l=>({uuid:l.uuid,name:l.name}))}}),ae("measurements",()=>ye.fetchMeasurements(),{onSuccess:t=>{W.value=t.map(l=>({uuid:l.uuid,name:l.name}))}});const he=async t=>{if(confirm(`Continue with the operation. Delete ${t.name} ?`)){const e=await b.deleteProduct({uuid:t.uuid});e.status==="success"?(g.refetchQueries("products"),_(e.message,"green","top")):_("There was an error","red","top-right")}},Pe=()=>{A.value=!1,oe.categories.length===0?_("You need to create at least one CATEGORY in order to create products!","orange","top"):(K.value="Add New Product",E.value=!0)},Ve=t=>{A.value=!0,K.value=`Edit ${t.name}`,re.value=t.uuid,E.value=!0,k.value=t.name,C.value=t.quantity,x.value=t.buying_price,D.value=t.selling_price,B.value=t.supplier,P.value=!!t.paid,Y.value=t.description,S.value=W.value.find(l=>l.name===t.measurement),U.value=H.value.find(l=>l.name===t.category)},we=async()=>{h.value="",Q.value=!0,P.value=!1;const t={name:k.value.trim(),quantity:C.value,selling_price:D.value,buying_price:x.value,category_uuid:U.value.uuid,measurement_uuid:S.value.uuid,supplier:B.value,paid:P.value,description:Y.value};if(t.name&&t.quantity&&t.selling_price&&t.buying_price&&t.category_uuid&&t.measurement_uuid&&t.supplier){const l=await b.createProduct(t);l.status==="success"?(g.refetchQueries("products"),X(),_(l.message,"green","top")):(h.value=l.message,_(l.message,"red","top-right"))}else h.value="All fields are required!",Q.value=!1,_("All fields are required!","red","top-right")},qe=async()=>{h.value="",Q.value=!0;const t={product_uuid:re.value,name:k.value.trim(),quantity:C.value,selling_price:D.value,buying_price:x.value,category_uuid:U.value.uuid,measurement_uuid:S.value.uuid,supplier:B.value,paid:P.value,description:Y.value};if(t.name&&t.quantity&&t.selling_price&&t.buying_price&&t.category_uuid&&t.measurement_uuid&&t.supplier){const l=await b.updateProduct(t);l.status==="success"?(g.refetchQueries("products"),g.refetchQueries("finished_products"),X(),_(l.message,"green","top")):_(l.message,"red","top-right")}else h.value="All fields are required!",_("All fields are required!","red","top-right")},Qe=()=>X(),_=(t,l,e)=>{c.notify({message:t,color:l,position:e})},X=()=>{k.value="",D.value=1,x.value=1,U.value="",S.value="",C.value=1,E.value=!1,Q.value=!1,A.value=!1,K.value="",h.value=""},Ce=t=>{const l=t.map(e=>({name:e.name,buying_price:e.buying_price,selling_price:e.selling_price,category:e.category,measurement:e.measurement,paid:e.paid,quantity:e.quantity,supplier:e.supplier,description:e.description,user:e.user,created_at:e.created_at}));Ne(l,_e,Be,c,"ProductsData")},xe=()=>{let t=M(s.from),l=M(s.to),e={};parseInt(t.diff(l,"seconds"))>=0?(e.from=s.from,e.to=s.to):(e.from=s.to,e.to=s.from),De(e),c.loading.show({message:`Please Wait. Fetching data between ${M(s.from).format("DD-MM-YY")} - ${M(s.to).format("DD-MM-YY")}`,boxClass:"bg-indigo text-white",spinnerColor:"white"})},{mutate:De}=Fe(t=>b.fetchProductsInDateRange(t),{onSuccess:t=>{var l;se.value=`(From: ${M(s.from).format("DD-MM-YY")} - To: ${M(s.to).format("DD-MM-YY")}). ${(l=t==null?void 0:t.data)==null?void 0:l.length} Records.`,I.value=t.data,c.loading.hide()}});return(t,l)=>(m(),V("div",Je,[a(Z,{dark:"",class:"bg-primary q-mb-sm q-pa-none"},{default:o(()=>[a(ce,null,{default:o(()=>{var e,z,L,O;return[a(y,{dense:"",flat:"",icon:"arrow_back",label:"Back",onClick:l[0]||(l[0]=$=>t.$router.back())}),a(F),a(y,{unelevated:"",class:"q-ma-xs",icon:"event",size:"sm",color:"indigo",label:"Calendar (Older Products)",onClick:l[1]||(l[1]=$=>be())}),a(F),n("span",null,[a(de,{modelValue:N.value,"onUpdate:modelValue":l[2]||(l[2]=$=>N.value=$),"checked-icon":"check",color:"orange","unchecked-icon":"clear",label:`${N.value?"Table View.":"Mobile View."}`},null,8,["modelValue","label"])]),!N.value&&p(ve)((L=(z=(e=p(d))==null?void 0:e.user)==null?void 0:z.user)==null?void 0:L.roles)?(m(),V("span",We,[a(y,{onClick:Pe,dense:"",color:"orange",size:"sm",icon:"add",label:"Add Product",unelevated:""}),((O=I.value)==null?void 0:O.length)>0?(m(),T(y,{key:0,dense:"",outline:"",icon:"archive",label:"Export Products",class:"q-ml-sm",size:"sm",onClick:l[3]||(l[3]=$=>Ce(I.value))})):w("",!0)])):w("",!0)]}),_:1})]),_:1}),p(ke)?(m(),V("div",He,"Loading products...")):p(ne)?(m(),V("div",Xe,"An error has occurred: "+v(p(ne)),1)):(m(),T(Me,{key:2,title:`Products : ${se.value}`,rows:I.value,columns:p(_e),separator:"cell","row-key":"name",filter:j.value,dense:"",grid:N.value},{body:o(e=>[a(Ee,{props:e,class:Te(`${e.row.quantity<1?"blink-bg":""}`)},{default:o(()=>{var z,L,O;return[a(f,{key:"name",props:e},{default:o(()=>[i(v(e.row.name),1)]),_:2},1032,["props"]),a(f,{key:"measurement",props:e},{default:o(()=>[i(v(e.row.measurement)+" ",1),n("small",null,[a(le,null,{default:o(()=>[i(": "+v(e.row.quantity),1)]),_:2},1024)])]),_:2},1032,["props"]),a(f,{key:"buying_price",props:e},{default:o(()=>[i(v(e.row.buying_price),1)]),_:2},1032,["props"]),a(f,{key:"selling_price",props:e},{default:o(()=>[i(v(e.row.selling_price),1)]),_:2},1032,["props"]),a(f,{key:"supplier",props:e},{default:o(()=>[i(v(e.row.supplier),1)]),_:2},1032,["props"]),a(f,{key:"paid",props:e},{default:o(()=>[e.row.paid?(m(),V("span",Ze,[a(le,{color:"primary"},{default:o(()=>[i("Paid")]),_:1})])):(m(),V("span",el,[a(le,{color:"negative"},{default:o(()=>[i("Not Paid")]),_:1})]))]),_:2},1032,["props"]),a(f,{key:"category",props:e},{default:o(()=>[i(v(e.row.category),1)]),_:2},1032,["props"]),a(f,{key:"user",props:e},{default:o(()=>[i(v(e.row.user),1)]),_:2},1032,["props"]),a(f,{key:"created_at",props:e},{default:o(()=>[i(v(e.row.created_at),1)]),_:2},1032,["props"]),p(ve)((O=(L=(z=p(d))==null?void 0:z.user)==null?void 0:L.user)==null?void 0:O.roles)?(m(),T(f,{key:"actions",props:e},{default:o(()=>[a(R,{color:"blue",name:"edit",onClick:$=>Ve(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),a(R,{color:"red",name:"delete",onClick:$=>he(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])):w("",!0)]}),_:2},1032,["props","class"])]),"top-right":o(()=>[a(q,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:j.value,"onUpdate:modelValue":l[4]||(l[4]=e=>j.value=e),placeholder:"Search product",class:"q-mr-md",clearable:""},{append:o(()=>[a(R,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["title","rows","columns","filter","grid"])),a(me,{modelValue:E.value,"onUpdate:modelValue":l[14]||(l[14]=e=>E.value=e),persistent:""},{default:o(()=>[a(Z,{style:{width:"500px"}},{default:o(()=>[a(ce,null,{default:o(()=>[n("span",ll,v(K.value),1),a(F),n("span",null,[a(de,{modelValue:P.value,"onUpdate:modelValue":l[5]||(l[5]=e=>P.value=e),"checked-icon":"check",color:"green","unchecked-icon":"clear",label:`${P.value?"Paid":"Not Paid."}`,class:"col-6"},null,8,["modelValue","label"])])]),_:1}),a(te,{color:"primary",class:"q-mb-sm"}),a(ee,{class:"q-pt-none"},{default:o(()=>[a(q,{outlined:"",dense:"",label:"Name",modelValue:k.value,"onUpdate:modelValue":l[6]||(l[6]=e=>k.value=e)},null,8,["modelValue"])]),_:1}),a(ee,{class:"q-pt-none"},{default:o(()=>[a(q,{outlined:"",dense:"",label:"Quantity",modelValue:C.value,"onUpdate:modelValue":l[7]||(l[7]=e=>C.value=e),type:"number",min:"1",oninput:"validity.valid||(value='')"},null,8,["modelValue"])]),_:1}),n("div",tl,[a(q,{outlined:"",dense:"",label:"Buying Price (Per Unit)",modelValue:x.value,"onUpdate:modelValue":l[8]||(l[8]=e=>x.value=e),type:"number",min:"1",oninput:"validity.valid||(value='');",class:"col-6"},null,8,["modelValue"]),a(q,{outlined:"",dense:"",label:"Selling Price (Per Unit)",modelValue:D.value,"onUpdate:modelValue":l[9]||(l[9]=e=>D.value=e),type:"number",min:"1",oninput:"validity.valid||(value='');",class:"col-6"},null,8,["modelValue"])]),n("div",al,[a(pe,{dense:"",outlined:"",modelValue:U.value,"onUpdate:modelValue":l[10]||(l[10]=e=>U.value=e),options:p(H),"option-value":"uuid","option-label":"name",label:"Select Product Category",class:"col-6"},null,8,["modelValue","options"]),a(pe,{dense:"",outlined:"",modelValue:S.value,"onUpdate:modelValue":l[11]||(l[11]=e=>S.value=e),options:p(W),"option-value":"uuid","option-label":"name",label:"Select Product Measurement",class:"col-6"},null,8,["modelValue","options"])]),n("div",ol,[n("small",null,v(h.value),1)]),n("div",rl,[a(q,{outlined:"",dense:"",label:"Supplier",modelValue:B.value,"onUpdate:modelValue":l[12]||(l[12]=e=>B.value=e),type:"text"},null,8,["modelValue"])]),n("div",ul,[a(q,{modelValue:Y.value,"onUpdate:modelValue":l[13]||(l[13]=e=>Y.value=e),label:"Description (Optional)",outlined:"",autogrow:""},null,8,["modelValue"])]),a(Ae,{align:"right"},{default:o(()=>[a(y,{flat:"",label:"Cancel",color:"red",onClick:Qe}),a(F),k.value&&!A.value?(m(),T(y,{key:0,flat:"",label:"Add Product",color:"primary",onClick:we,loading:Q.value},null,8,["loading"])):w("",!0),k.value&&A.value?(m(),T(y,{key:1,flat:"",label:"Edit Product",color:"primary",onClick:qe,loading:Q.value},null,8,["loading"])):w("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(me,{modelValue:J.value,"onUpdate:modelValue":l[17]||(l[17]=e=>J.value=e),persistent:""},{default:o(()=>[a(Z,{class:"bg-indigo text-white text-center q-pa-sm",style:{width:"300px"}},{default:o(()=>[n("div",sl,[n("b",null,[a(R,{name:"events"}),i(" Date Picker")])]),a(te,{color:"white"}),a(ee,null,{default:o(()=>[n("div",null,[i(" From : "),G(n("input",{type:"date","onUpdate:modelValue":l[15]||(l[15]=e=>s.from=e),max:p(ue)},null,8,nl),[[ie,s.from]])]),il,s.from?(m(),V("div",dl,[i(" To : "),G(n("input",{type:"date","onUpdate:modelValue":l[16]||(l[16]=e=>s.to=e),max:p(ue)},null,8,cl),[[ie,s.to]])])):w("",!0)]),_:1}),a(te,{color:"yellow"}),a(Ye,{flat:"",class:"full-width"},{default:o(()=>[G(a(y,{dense:"",label:"Cancel",color:"yellow",flat:""},null,512),[[ge]]),a(F),s.to?G((m(),T(y,{key:0,dense:"",label:"Fetch Products",color:"white",flat:"",onClick:xe},null,512)),[[ge]]):w("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ml as default};
