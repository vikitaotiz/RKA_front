import{r as o,aI as i,a5 as N,d as t,bb as r,u,P as s,a3 as A,bE as V,a6 as v,a4 as x,ac as c,bD as O,M as de}from"./index.fae37851.js";import{Q as K}from"./QSpace.9bb116ce.js";import{Q as ce}from"./QToggle.5f9346e8.js";import{Q as me}from"./QToolbar.6c749aef.js";import{a as W,Q as Y}from"./QCard.7f9f5af3.js";import{Q as pe,a as ve,b as m,c as ge,d as X,e as fe,f as _e,g as ye}from"./excel.f4ee1974.js";import{Q as be}from"./QBadge.778f8908.js";import{Q as U}from"./QInput.cbe838d7.js";import{a as ke}from"./use-quasar.d6bd9522.js";import{a as Ve,u as F}from"./index.bcdac246.js";import{u as Pe}from"./product-store.a4e15334.js";import{u as Qe}from"./category-store.fea85062.js";import{u as qe}from"./measurement-store.07f7a576.js";import{u as we}from"./auth-store.fd1bfc09.js";import{h as Z}from"./helpers.a81d5275.js";import"./use-dark.69a0fc24.js";import"./QSeparator.751afa3e.js";import"./QList.d039015e.js";import"./rtl.17ee702b.js";import"./module_calls.108866f1.js";const ee=[{name:"name",required:!0,label:"Name",align:"left",field:B=>B.name,format:B=>`${B}`,sortable:!0},{name:"measurement",align:"center",label:"Measurement & Qty",field:"measurement",sortable:!0},{name:"buying_price",align:"center",label:"Buying Price (Per Unit)",field:"buying_price",sortable:!0},{name:"selling_price",align:"center",label:"Selling Price (Per Unit)",field:"selling_price",sortable:!0},{name:"category",align:"center",label:"Category",field:"category",sortable:!0},{name:"user",align:"center",label:"Created By",field:"user",sortable:!0},{name:"created_at",align:"center",label:"Created On",field:"created_at",sortable:!0},{name:"actions",align:"center",label:"Actions",field:"created_at"}];const Ce={class:"q-pa-md"},he={key:0,class:"q-ml-sm"},Se={key:0},Ae={key:1},xe={class:"text-h6"},Ue={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},Be={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},Ee={class:"text-center error_msg"},el={__name:"Products",setup(B){const G=we(),R=ke(),E=Ve(),$=Pe(),j=Qe(),le=qe(),P=o(!1),Q=o(!1),g=o(!1),q=o(!1),D=o(""),T=o(""),H=o(""),p=o(""),d=o(""),f=o(1),_=o(1),y=o(1),{data:M,isLoading:ae,isError:J}=F("products",()=>$.fetchProducts()),b=o("");let z=o([]);const k=o("");let I=o([]);F("categories",()=>j.fetchCategories(),{onSuccess:a=>{I.value=a.map(l=>({uuid:l.uuid,name:l.name}))}}),F("measurements",()=>le.fetchMeasurements(),{onSuccess:a=>{z.value=a.map(l=>({uuid:l.uuid,name:l.name}))}});const te=async a=>{if(confirm(`Continue with the operation. Delete ${a.name} ?`)){const e=await $.deleteProduct({uuid:a.uuid});e.status==="success"?(E.refetchQueries("products"),n(e.message,"green","top")):n("There was an error","red","top-right")}},re=()=>{Q.value=!1,j.categories.length===0?n("You need to create at least one CATEGORY in order to create products!","orange","top"):(T.value="Add New Product",P.value=!0)},oe=a=>{Q.value=!0,T.value=`Edit ${a.name}`,H.value=a.uuid,P.value=!0,d.value=a.name,f.value=a.quantity,_.value=a.buying_price,y.value=a.selling_price,b.value=z.value.find(l=>l.name===a.measurement),k.value=I.value.find(l=>l.name===a.category)},ue=async()=>{p.value="",g.value=!0;const a={name:d.value.trim(),quantity:f.value,selling_price:y.value,buying_price:_.value,category_uuid:k.value.uuid,measurement_uuid:b.value.uuid};if(a.name&&a.quantity&&a.selling_price&&a.buying_price&&a.category_uuid&&a.measurement_uuid){const l=await $.createProduct(a);l.status==="success"?(E.refetchQueries("products"),L(),n(l.message,"green","top")):(p.value=l.message,n(l.message,"red","top-right"))}else p.value="All fields are required!",g.value=!1,n("All fields are required!","red","top-right")},se=async()=>{p.value="",g.value=!0;const a={product_uuid:H.value,name:d.value.trim(),quantity:f.value,selling_price:y.value,buying_price:_.value,category_uuid:k.value.uuid,measurement_uuid:b.value.uuid};if(a.name&&a.quantity&&a.selling_price&&a.buying_price&&a.category_uuid&&a.measurement_uuid){const l=await $.updateProduct(a);l.status==="success"?(E.refetchQueries("products"),E.refetchQueries("finished_products"),L(),n(l.message,"green","top")):n(l.message,"red","top-right")}else p.value="All fields are required!",n("All fields are required!","red","top-right")},ne=()=>L(),n=(a,l,e)=>{R.notify({message:a,color:l,position:e})},L=()=>{d.value="",y.value=1,_.value=1,k.value="",b.value="",f.value=1,P.value=!1,g.value=!1,Q.value=!1,T.value="",p.value=""},ie=a=>{const l=a.map(e=>({name:e.name,products:e.products.length,created_at:e.created_at}));_e(l,ee,ye,R,"ProductsData")};return(a,l)=>(i(),N("div",Ce,[t(W,{dark:"",class:"bg-primary q-mb-sm q-pa-none"},{default:r(()=>[t(me,null,{default:r(()=>{var e,w,C,h;return[t(V,{dense:"",flat:"",icon:"arrow_back",label:"Back",onClick:l[0]||(l[0]=S=>a.$router.back())}),t(K),v("span",null,[t(ce,{modelValue:q.value,"onUpdate:modelValue":l[1]||(l[1]=S=>q.value=S),"checked-icon":"check",color:"orange","unchecked-icon":"clear",label:`${q.value?"Table View.":"Mobile View."}`},null,8,["modelValue","label"])]),!q.value&&u(Z)((C=(w=(e=u(G))==null?void 0:e.user)==null?void 0:w.user)==null?void 0:C.roles)?(i(),N("span",he,[t(V,{onClick:re,dense:"",color:"orange",size:"sm",icon:"add",label:"Add Product",unelevated:""}),((h=u(M))==null?void 0:h.length)>0?(i(),A(V,{key:0,dense:"",outline:"",icon:"archive",label:"Export Products",class:"q-ml-sm",size:"sm",onClick:l[2]||(l[2]=S=>ie(u(M)))})):x("",!0)])):x("",!0)]}),_:1})]),_:1}),u(ae)?(i(),N("div",Se,"Loading products...")):u(J)?(i(),N("div",Ae,"An error has occurred: "+s(u(J)),1)):(i(),A(pe,{key:2,title:"All Products",rows:u(M),columns:u(ee),separator:"cell","row-key":"name",filter:D.value,dense:"",grid:q.value},{body:r(e=>[t(ge,{props:e,class:de(`${e.row.quantity<1?"blink-bg":""}`)},{default:r(()=>{var w,C,h;return[t(m,{key:"name",props:e},{default:r(()=>[c(s(e.row.name),1)]),_:2},1032,["props"]),t(m,{key:"measurement",props:e},{default:r(()=>[c(s(e.row.measurement)+" ",1),v("small",null,[t(be,null,{default:r(()=>[c(": "+s(e.row.quantity),1)]),_:2},1024)])]),_:2},1032,["props"]),t(m,{key:"buying_price",props:e},{default:r(()=>[c(s(e.row.buying_price),1)]),_:2},1032,["props"]),t(m,{key:"selling_price",props:e},{default:r(()=>[c(s(e.row.selling_price),1)]),_:2},1032,["props"]),t(m,{key:"category",props:e},{default:r(()=>[c(s(e.row.category),1)]),_:2},1032,["props"]),t(m,{key:"user",props:e},{default:r(()=>[c(s(e.row.user),1)]),_:2},1032,["props"]),t(m,{key:"created_at",props:e},{default:r(()=>[c(s(e.row.created_at),1)]),_:2},1032,["props"]),u(Z)((h=(C=(w=u(G))==null?void 0:w.user)==null?void 0:C.user)==null?void 0:h.roles)?(i(),A(m,{key:"actions",props:e},{default:r(()=>[t(O,{color:"blue",name:"edit",onClick:S=>oe(e.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),t(O,{color:"red",name:"delete",onClick:S=>te(e.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])):x("",!0)]}),_:2},1032,["props","class"])]),"top-right":r(()=>[t(U,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:D.value,"onUpdate:modelValue":l[3]||(l[3]=e=>D.value=e),placeholder:"Search product",class:"q-mr-md",clearable:""},{append:r(()=>[t(O,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter","grid"])),t(ve,{modelValue:P.value,"onUpdate:modelValue":l[10]||(l[10]=e=>P.value=e),persistent:""},{default:r(()=>[t(W,{style:{width:"500px"}},{default:r(()=>[t(Y,null,{default:r(()=>[v("div",xe,s(T.value),1)]),_:1}),t(Y,{class:"q-pt-none"},{default:r(()=>[t(U,{outlined:"",dense:"",label:"Name",modelValue:d.value,"onUpdate:modelValue":l[4]||(l[4]=e=>d.value=e)},null,8,["modelValue"])]),_:1}),t(Y,{class:"q-pt-none"},{default:r(()=>[t(U,{outlined:"",dense:"",label:"Quantity",modelValue:f.value,"onUpdate:modelValue":l[5]||(l[5]=e=>f.value=e),type:"number",min:"1",oninput:"validity.valid||(value='')"},null,8,["modelValue"])]),_:1}),v("div",Ue,[t(U,{outlined:"",dense:"",label:"Buying Price (Per Unit)",modelValue:_.value,"onUpdate:modelValue":l[6]||(l[6]=e=>_.value=e),type:"number",min:"1",oninput:"validity.valid||(value='');",class:"col-6"},null,8,["modelValue"]),t(U,{outlined:"",dense:"",label:"Selling Price (Per Unit)",modelValue:y.value,"onUpdate:modelValue":l[7]||(l[7]=e=>y.value=e),type:"number",min:"1",oninput:"validity.valid||(value='');",class:"col-6"},null,8,["modelValue"])]),v("div",Be,[t(X,{dense:"",outlined:"",modelValue:k.value,"onUpdate:modelValue":l[8]||(l[8]=e=>k.value=e),options:u(I),"option-value":"uuid","option-label":"name",label:"Select Product Category",class:"col-6"},null,8,["modelValue","options"]),t(X,{dense:"",outlined:"",modelValue:b.value,"onUpdate:modelValue":l[9]||(l[9]=e=>b.value=e),options:u(z),"option-value":"uuid","option-label":"name",label:"Select Product Measurement",class:"col-6"},null,8,["modelValue","options"])]),v("div",Ee,[v("small",null,s(p.value),1)]),t(fe,{align:"right"},{default:r(()=>[t(V,{flat:"",label:"Cancel",color:"red",onClick:ne}),t(K),d.value&&!Q.value?(i(),A(V,{key:0,flat:"",label:"Add Product",color:"primary",onClick:ue,loading:g.value},null,8,["loading"])):x("",!0),d.value&&Q.value?(i(),A(V,{key:1,flat:"",label:"Edit Product",color:"primary",onClick:se,loading:g.value},null,8,["loading"])):x("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{el as default};
